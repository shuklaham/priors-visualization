
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Demo: Long bar chart</title>
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <style type="text/css">
        
            div.bar {
                display: inline-block;
                width: 20px;
                height: 75px;   /* Gets overriden by D3-assigned height below */
                margin-right: 2px;
                background-color: teal;
            }

            .report1:hover {
                /*fill: #d3d3d3;*/
                fill: #7e7e7e;
            }
            .report2:hover {
                /*fill: #d3d3d3;*/
                fill: #7e7e7e;
            }
            .report3:hover {
                /*fill: #d3d3d3;*/
                fill: #7e7e7e;
            }

            #tooltip {
                position: absolute;
                width: 200px;
                height: auto;
                padding: 10px;
                background-color: white;
                -webkit-border-radius: 10px;
                -moz-border-radius: 10px;
                border-radius: 10px;
                -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
                pointer-events: none;
            }

            #tooltip.hidden {
                display: none;
            }
            #tooltip p {
                margin: 0;
                font-family: sans-serif;
                font-size: 16px;
                line-height: 20px;
            }

        
        </style>
    </head>
    <body>
        <div id="tooltip" class="hidden">
            <p><span id="value">100</span></p>
        </div>
        <script type="text/javascript">

        //Width and height
        var w = 800;
        var h = 800;        
        var findings = ["Hepatic Lesions",
                        "Lymphadenopathy",
                        "Adrenal Nodules",
                        "Retroperitoneal Edema",
                        "Small Volume Ascites",
                        "Soft Tissue Thickening",
                        "Vertebral Body",
                        "Metastasis",
                        "Hepatic Metastases",
                        "Adrenal Metastasis"]

        var colorArray = {};
        colorArray[-1] = "#FF0000"
        colorArray[1] = "#84AB14"
        colorArray[0] = "black"

        var rep1 = [
            [0,''],
            [1,'Progression of disease with increase in lymphadenopathy'],
            [1,''],
            [1,''],
            [1,'Increased mesenteric/retroperitoneal edema'],
            [1,'Soft tissue thickening along the undersurface of the left diaphragm is stable from the recent exam but increased from older studies and suspicious for peritoneal tumor.'],
            [1,'Increase in subtle sclerosis in the superior half of the L2 vertebral body'],
            [1,''],
            [0,''],
            [0,'']
        ]









        var rep2 = [-1,1,0,0,0,0,0,0,1,1]
        














        var rep3 = [-1,1,0,0,0,0,0,0,1,1]
        















        datesreps = ["2015-11-01","2015-09-01","2015-07-01"]

        var legendArray = ["Presence", "Absence","No mention"]


        //Create SVG element
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

        svg.selectAll("text.findings")
               .data(findings)
               .enter()
               .append("text")
               .attr("class","findings")
               .text(function(d) {
                    return d;
               })
               .attr("text-anchor", "left")
               .attr("x", 50)
               .attr("y", function(d,i) {
                    return 55 + (i)*50;
               })
               .attr("font-family", "sans-serif")
               .attr("font-size", "13px")
               .attr("font-weight","bold")
               .attr("fill", "black");

        svg.selectAll("rect.report1")
               .data(rep1)
               .enter()
               .append("rect")
               .attr("class", "report1")
               .attr("x", function(d, i) {
                    return 210
               })
               .attr("y", function(d, i) {
                    return 35+(i)*50;
               })
               .attr("width", 105)
               .attr("height", 40)
               .attr("fill", function(d) {
                    return colorArray[d[0]]})
               .on("mouseover", function(d) {

                //Get this bar's x/y values, then augment for the tooltip
                var xPosition = parseFloat(d3.select(this).attr("x")) + 50;
                var yPosition = parseFloat(d3.select(this).attr("y")) - 10;

                //Update the tooltip position and value
                d3.select("#tooltip")
                  .style("left", xPosition + "px")
                  .style("top", yPosition + "px")
                  .select("#value")
                  .text(d[1]);

                //Show the tooltip
                d3.select("#tooltip").classed("hidden", false);

                })
               .on("mouseout", function() {

                //Hide the tooltip
                d3.select("#tooltip").classed("hidden", true);

                });

        svg.selectAll("rect.report2")
               .data(rep2)
               .enter()
               .append("rect")
               .attr("class", "report2")               
               .attr("x", function(d, i) {
                    return 325
               })
               .attr("y", function(d, i) {
                    return 35+(i)*50;
               })
               .attr("width", 105)
               .attr("height", 40)
               .attr("fill", function(d) {
                    return colorArray[d]});

        svg.selectAll("rect.report3")
               .data(rep3)
               .enter()
               .append("rect")
               .attr("class", "report3")               
               .attr("x", function(d, i) {
                    return 440
               })
               .attr("y", function(d, i) {
                    return 35+(i)*50;
               })
               .attr("width", 105)
               .attr("height", 40)
               .attr("fill", function(d) {
                    return colorArray[d]});

        svg.selectAll("rect.legend")
               .data(legendArray)
               .enter()
               .append("rect")
               .attr("class", "legend")
               .attr("x", function(d, i) {
                    return 700;
               })
               .attr("y", function(d, i) {
                    return 35+(i)*50;
               })
               .attr("width", 105)
               .attr("height", 40)
               .attr("fill", function(d, i) {
                    if( i == 0){
                        return colorArray[1]}
                    else if(i == 1){
                        return colorArray[-1]
                    }
                    else{
                        return colorArray[0]
                    }

            });

        svg.selectAll("text.legendText")
               .data(legendArray)
               .enter()
               .append("text")
               .attr("class","legendText")
               .text(function(d){
                    return d;
               })
               .attr("text-anchor", "middle")
               .attr("x", function(d, i){
                    return 650})
               .attr("y", function(d, i) {
                    return 55+(i)*50;
                })
               .attr("font-size", "14px")
               .attr("font-weight","bold")
               .attr("fill", "black");


        svg.selectAll("text.dates_reps")
               .data(datesreps)
               .enter()
               .append("text")
               .attr("class","dates_reps")
               .text(function(d){
                    /*return d*/
                    var months;
                    d1 = new Date(d);
                    d2 = new Date();
                    months = (d2.getFullYear() - d1.getFullYear()) * 12;
                    months -= d1.getMonth() + 1;
                    months += d2.getMonth();
                    months = months <= 0 ? 0 : months;
                    if(months < 1){
                                return "< 1 month old";
                            }
                            else{
                                return ''+ months + ' months old';
                            }
                    })
               .attr("text-anchor", "middle")
               .attr("x", function(d, i){
                    return 260 + 115*i})
               .attr("y", 30)
               .attr("font-size", "14px")
               .attr("font-weight","bold")
               .attr("fill", "black");
       
        /*function diffMonths(d){
            var months;
            d1 = new Date(d1);
            d2 = new Date();
            months = (d2.getFullYear() - d1.getFullYear()) * 12;
            months -= d1.getMonth() + 1;
            months += d2.getMonth();
            months = months <= 0 ? 0 : months;
            if(diff < 1){
                        return "< 1 month old";
                    }
                    else{
                        return ''+ months + 'old';
                    }
        }*/



            
        </script>
    </body>
</html>