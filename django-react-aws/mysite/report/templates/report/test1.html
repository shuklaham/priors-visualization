<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sunburst</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://fb.me/react-with-addons-15.1.0.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/babel">
      // To get started with this tutorial running your own code, simply remove
      // the script tag loading scripts/example.js and start writing code here.

var jsonObject = JSON.parse('{{ report | escapejs }}');
// <p>{this.props.data["Album"]}</p>
//  data = {jsonObject}
var ReportBox = React.createClass({
  loadReportFromServer: function(){
    var report_num = this.props.reportId["id"]
    var getURL = 'http://localhost:8000/get_parsed_report/'.concat(report_num)
    $.ajax({
      url: getURL,
      dataType: 'json',
      cache: false,
      success: function(data) {
        console.log('first here')
        console.log(data)
        //temp = JSON.parse('{{ data | escapejs }}')
        this.setState({ 
          flag: false,
          reportData:data
        });
        console.log(this.state)
      }.bind(this),
      error: function(xhr, status, err) {
        console.error(this.props.url, status, err.toString());
      }.bind(this)
    })
    
  },
  getInitialState: function() {
    return {
      flag: true,
      reportData:[]
    };
  },
  componentDidMount: function() {
    this.loadReportFromServer();
    //console.log('then here')
    //console.log(this.state.temp)
    //setInterval(this.loadReportFromServer, this.props.pollInterval);
  },
  render: function() {
    var loginButton;
    if (this.state.flag) {
      loginButton = <img src='/static/images/cube.gif' />;
    } else {
      loginButton = <h1>{this.state.reportData[0].y}</h1>;
    }
    return (
      <nav>
        {loginButton}
      </nav>
    );

/*
    return (
      <div className="reportBox">
        <h1>Sunburst</h1>
        <p>{this.state.temp["Album"]}</p>
        <img src='/static/images/cube.gif' />
        <p>{this.props.reportId["id"]}</p>
      </div>
    );*/
  }
});
ReactDOM.render(
  <ReportBox reportId = {jsonObject}/>,
  document.getElementById('content')
);
    </script>
  </body>
</html>